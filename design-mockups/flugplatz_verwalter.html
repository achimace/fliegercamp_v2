<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anfragen verwalten - Fliegercamp</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Projekt-Styles -->
    <link rel="stylesheet" href="assets/styles.css">

    <style>
        /* Layout-Grid f√ºr Dreiteilung */
        .manager-layout {
            display: grid;
            grid-template-columns: 25% 45% 30%;
            gap: 1.5rem;
            height: calc(100vh - 140px);
            max-width: 1440px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Responsive Anpassungen */
        @media (max-width: 1280px) {
            .manager-layout {
                grid-template-columns: 35% 65%;
            }
            .communication-panel {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .manager-layout {
                display: none !important;
            }
            .mobile-tabs-wrapper {
                display: block !important;
            }
        }

        /* Mobile Tabs Wrapper */
        .mobile-tabs-wrapper {
            display: none;
            max-width: 1440px;
            margin: 0 auto;
            padding: 1rem;
        }

        .mobile-tabs-nav {
            display: flex;
            border-bottom: 2px solid #E5E5E5;
            margin-bottom: 1rem;
            background: #fff;
            border-radius: 0.5rem 0.5rem 0 0;
            overflow-x: auto;
        }

        .mobile-tab-button {
            flex: 1;
            min-width: 100px;
            padding: 1rem;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.75rem;
            transition: all 0.2s;
            color: #737373;
            white-space: nowrap;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .mobile-tab-button i {
            font-size: 1.25rem;
        }

        .mobile-tab-button.active {
            border-bottom-color: #10B981;
            font-weight: 600;
            color: #10B981;
        }

        .mobile-tab-button:hover {
            background: #F8F7F4;
            color: #10B981;
        }

        .mobile-tab-content {
            display: none;
        }

        .mobile-tab-content.active {
            display: block;
        }

        /* Linke Spalte: Anfrageliste */
        .requests-panel {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            margin-bottom: 1rem;
        }

        .panel-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #000;
            margin: 0 0 0.5rem 0;
        }

        .panel-subtitle {
            font-size: 0.875rem;
            color: #737373;
            margin: 0;
        }

        /* Filter Section */
        .filter-section {
            background: #fff;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .filter-row {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .filter-row:last-child {
            margin-bottom: 0;
        }

        .filter-select {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid #E5E5E5;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-family: 'Poppins', sans-serif;
            color: #000;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-select:hover {
            border-color: #D4D4D4;
        }

        .filter-select:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 0.75rem 0.5rem 2.5rem;
            border: 1px solid #E5E5E5;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-family: 'Poppins', sans-serif;
            color: #000;
            background: #fff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23737373" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>') no-repeat 0.75rem center;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .filter-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.75rem;
            border-top: 1px solid #E5E5E5;
            margin-top: 0.75rem;
            font-size: 0.75rem;
            color: #737373;
        }

        .requests-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .request-list-card {
            background: #fff;
            border: 2px solid #E5E5E5;
            border-left: 4px solid transparent;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            position: relative;
        }

        .request-list-card:hover {
            border-color: #D4D4D4;
            border-left-color: #10B981;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateX(2px);
        }

        .request-list-card.active {
            border-color: #10B981;
            border-left-color: #10B981;
            border-left-width: 4px;
            background: #F0FDF4;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
        }

        .request-list-card.new {
            border-left-color: #A3A3A3;
        }

        .request-list-card.new.active {
            border-left-color: #10B981;
        }

        .request-card-header-small {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .request-card-organizer {
            font-weight: 600;
            font-size: 0.875rem;
            color: #000;
            margin-bottom: 0.25rem;
        }

        .request-card-campname {
            font-size: 0.75rem;
            color: #737373;
            font-weight: 400;
        }

        .request-card-date {
            font-size: 0.75rem;
            color: #525252;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .request-card-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: #737373;
            margin-bottom: 0.75rem;
        }

        .request-card-meta-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .new-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #EF4444;
            color: #fff;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.625rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Status Badges */
        .status-badge-wrapper {
            position: relative;
            display: inline-block;
        }

        .status-badge-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #171717;
            color: #fff;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            margin-bottom: 0.5rem;
            z-index: 1000;
        }

        .status-badge-wrapper:hover .status-badge-tooltip {
            opacity: 1;
        }

        .badge-custom {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            background: #F5F5F5;
            color: #737373;
            border: 1px solid #E5E5E5;
        }

        .badge-new {
            background: #F5F5F5;
            color: #737373;
            border-color: #D4D4D4;
        }

        .badge-seen {
            background: #FEF3C7;
            color: #B45309;
            border-color: #FCD34D;
        }

        .badge-confirmed {
            background: #D1FAE5;
            color: #065F46;
            border-color: #6EE7B7;
        }

        .badge-rejected {
            background: #FEE2E2;
            color: #991B1B;
            border-color: #FCA5A5;
        }

        .badge-active {
            background: #DBEAFE;
            color: #1E40AF;
            border-color: #93C5FD;
        }

        .badge-completed {
            background: #E5E5E5;
            color: #525252;
            border-color: #D4D4D4;
        }

        /* Mittlere Spalte: Detail Panel */
        .detail-panel {
            display: flex;
            flex-direction: column;
            background: #fff;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .detail-header {
            padding: 1.5rem;
            border-bottom: 1px solid #E5E5E5;
            background: #fff;
        }

        .detail-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-header-info {
            flex: 1;
        }

        .detail-organizer-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #000;
            margin-bottom: 0.25rem;
        }

        .detail-camp-name {
            font-size: 0.875rem;
            color: #737373;
            margin-bottom: 0.75rem;
        }

        .detail-contact {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            font-size: 0.75rem;
            color: #737373;
        }

        .detail-contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .detail-header-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            min-width: 200px;
        }

        .btn-approve {
            padding: 0.75rem 1.5rem;
            background: #10B981;
            color: #fff;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-approve:hover {
            background: #059669;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
            transform: translateY(-2px);
        }

        .btn-approve:active {
            transform: translateY(0);
        }

        .btn-reject {
            padding: 0.75rem 1.5rem;
            background: #fff;
            color: #EF4444;
            border: 2px solid #EF4444;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-reject:hover {
            background: #EF4444;
            color: #fff;
            box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        .btn-reject:active {
            transform: translateY(0);
        }

        .btn-message {
            padding: 0.75rem 1.5rem;
            background: #fff;
            color: #000;
            border: 2px solid #E5E5E5;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-message:hover {
            background: #F8F7F4;
            border-color: #000;
        }

        .detail-scrollable {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .detail-body {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .detail-section {
            background: #F8F7F4;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .detail-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #000;
            margin-bottom: 1rem;
        }

        .form-row-inline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group-inline {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label-inline {
            font-size: 0.875rem;
            font-weight: 500;
            color: #737373;
        }

        .form-input-inline {
            padding: 0.75rem;
            border: 1px solid #E5E5E5;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #000;
            background: #fff;
            transition: all 0.2s;
        }

        .form-input-inline:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-input-inline:disabled {
            background: #F5F5F5;
            color: #A3A3A3;
            cursor: not-allowed;
        }

        .form-textarea-inline {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #E5E5E5;
            border-radius: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            color: #000;
            resize: vertical;
            min-height: 80px;
            transition: all 0.2s;
        }

        .form-textarea-inline:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-textarea-inline:disabled {
            background: #F5F5F5;
            color: #A3A3A3;
            cursor: not-allowed;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 1rem;
            text-align: center;
            color: #737373;
            height: 100%;
        }

        .empty-state-icon {
            font-size: 4rem;
            color: #D4D4D4;
            margin-bottom: 1rem;
        }

        .empty-state-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #404040;
            margin-bottom: 0.5rem;
        }

        .empty-state-text {
            font-size: 0.875rem;
            max-width: 400px;
        }

        /* Kalender Widget */
        .calendar-widget {
            background: #fff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-title {
            font-size: 1rem;
            font-weight: 600;
            color: #000;
        }

        .calendar-nav {
            display: flex;
            gap: 0.5rem;
        }

        .calendar-nav-btn {
            background: transparent;
            border: 1px solid #E5E5E5;
            border-radius: 0.375rem;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-nav-btn:hover {
            background: #F8F7F4;
            border-color: #D4D4D4;
        }

        .calendar-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #E5E5E5;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: #737373;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 0.25rem;
        }

        .legend-dot.current {
            background: #FFD700;
            border: 2px solid #000;
        }

        .legend-dot.confirmed {
            background: #10B981;
        }

        .legend-dot.pending {
            background: #F59E0B;
        }

        .legend-dot.blocked {
            background: #E5E5E5;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #737373;
            padding: 0.5rem 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border: 2px solid transparent;
        }

        .calendar-day.disabled {
            color: #D4D4D4;
            cursor: default;
        }

        .calendar-day.current {
            background: #FFD700;
            border-color: #000;
            color: #000;
            font-weight: 600;
        }

        .calendar-day.confirmed {
            background: #D1FAE5;
            color: #065F46;
            border-color: #10B981;
        }

        .calendar-day.confirmed:hover {
            background: #A7F3D0;
        }

        .calendar-day.pending {
            background: #FEF3C7;
            color: #B45309;
            border-color: #F59E0B;
        }

        .calendar-day.pending:hover {
            background: #FDE68A;
        }

        .calendar-day.blocked {
            background: #F5F5F5;
            color: #A3A3A3;
            cursor: default;
        }

        .calendar-day.today {
            font-weight: 600;
            position: relative;
        }

        .calendar-day.today::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: currentColor;
            border-radius: 50%;
        }

        /* Communication Panel */
        .communication-panel {
            display: flex;
            flex-direction: column;
            background: #fff;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .communication-tabs {
            display: flex;
            border-bottom: 2px solid #E5E5E5;
            background: #F8F7F4;
        }

        .comm-tab {
            flex: 1;
            padding: 1rem;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s;
            color: #737373;
        }

        .comm-tab.active {
            border-bottom-color: #10B981;
            background: #fff;
            font-weight: 600;
            color: #10B981;
        }

        .comm-tab:hover {
            color: #10B981;
        }

        .comm-tab-content {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .comm-tab-content.active {
            display: flex;
        }

        /* Chat */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            max-width: 85%;
        }

        .chat-message.sent {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .chat-message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #10B981;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.75rem;
            color: #fff;
            flex-shrink: 0;
        }

        .chat-message.received .chat-message-avatar {
            background: #F8F7F4;
            color: #000;
        }

        .chat-message-content {
            flex: 1;
        }

        .chat-message-bubble {
            background: #F8F7F4;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            line-height: 1.5;
            color: #000;
            word-wrap: break-word;
        }

        .chat-message.sent .chat-message-bubble {
            background: #10B981;
            color: #fff;
            border-bottom-right-radius: 0.25rem;
        }

        .chat-message.received .chat-message-bubble {
            border-bottom-left-radius: 0.25rem;
        }

        .chat-message-time {
            font-size: 0.75rem;
            color: #A3A3A3;
            margin-top: 0.25rem;
            padding: 0 0.5rem;
        }

        .chat-message.sent .chat-message-time {
            text-align: right;
        }

        .chat-footer {
            padding: 1rem;
            border-top: 1px solid #E5E5E5;
            display: flex;
            gap: 0.75rem;
        }

        .chat-textarea {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #E5E5E5;
            border-radius: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        .chat-textarea:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .chat-send-button {
            padding: 0.75rem 1rem;
            background: #10B981;
            color: #fff;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .chat-send-button:hover {
            background: #059669;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
        }

        .chat-send-button i {
            font-size: 1.25rem;
        }

        .chat-empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
            color: #737373;
        }

        .chat-empty-icon {
            font-size: 3rem;
            color: #D4D4D4;
            margin-bottom: 1rem;
        }

        /* Internal Notes */
        .notes-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .note-item {
            background: #FEF3C7;
            border-left: 4px solid #F59E0B;
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .note-author {
            font-weight: 600;
            font-size: 0.875rem;
            color: #000;
        }

        .note-date {
            font-size: 0.75rem;
            color: #737373;
        }

        .note-text {
            font-size: 0.875rem;
            line-height: 1.5;
            color: #000;
        }

        .notes-footer {
            padding: 1rem;
            border-top: 1px solid #E5E5E5;
        }

        .note-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #E5E5E5;
            border-radius: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 0.75rem;
        }

        .note-textarea:focus {
            outline: none;
            border-color: #F59E0B;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        /* Info Boxes */
        .info-box {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            gap: 0.75rem;
            border: 1px solid;
        }

        .info-box.info {
            background: #DBEAFE;
            border-color: #3B82F6;
        }

        .info-box.warning {
            background: #FEF3C7;
            border-color: #F59E0B;
        }

        .info-box.success {
            background: #D1FAE5;
            border-color: #10B981;
        }

        .info-box.error {
            background: #FEE2E2;
            border-color: #EF4444;
        }

        .info-box-icon {
            flex-shrink: 0;
            font-size: 1.25rem;
        }

        .info-box-content {
            flex: 1;
        }

        .info-box-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .info-box-text {
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 1rem;
        }

        .modal-content {
            background: #fff;
            border-radius: 0.75rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #E5E5E5;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #000;
            margin: 0;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-description {
            font-size: 0.875rem;
            color: #737373;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #E5E5E5;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Button Styles */
        .button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
        }

        .button-primary {
            background: #10B981;
            color: #fff;
        }

        .button-primary:hover {
            background: #059669;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
            transform: translateY(-2px);
        }

        .button-secondary {
            background: transparent;
            color: #000;
            border: 2px solid #E5E5E5;
        }

        .button-secondary:hover {
            background: #F8F7F4;
            border-color: #000;
        }

        .button-danger {
            background: #EF4444;
            color: #fff;
        }

        .button-danger:hover {
            background: #DC2626;
            box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        /* Snackbar */
        .snackbar {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: #171717;
            color: #fff;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            z-index: 10000;
            animation: slideUp 0.3s ease-out;
        }

        .snackbar.success {
            background: #10B981;
        }

        .snackbar.error {
            background: #EF4444;
        }

        .snackbar i {
            font-size: 1.25rem;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 100%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        @keyframes slideDown {
            from {
                transform: translate(-50%, 0);
                opacity: 1;
            }
            to {
                transform: translate(-50%, 100%);
                opacity: 0;
            }
        }

        .snackbar.hiding {
            animation: slideDown 0.3s ease-in;
        }
    </style>
</head>

<body data-active-nav="flugplatz">
    <!-- Globale Navigation -->
    <div id="global-layout"></div>

    <main class="flex-grow-1">
        <!-- Breadcrumb -->
        <div class="breadcrumb-custom">
            <a class="breadcrumb-item-custom" href="/">
                <i class="bi bi-house-door"></i>
                <span>Home</span>
            </a>
            <span class="breadcrumb-separator">‚Ä∫</span>
            <span class="breadcrumb-item-custom">Anfragen verwalten</span>
        </div>

        <!-- Mobile Tabs Wrapper -->
        <div class="mobile-tabs-wrapper">
            <!-- Mobile Tabs Navigation -->
            <div class="mobile-tabs-nav">
                <button class="mobile-tab-button active" data-mobile-tab="requests">
                    <i class="bi bi-list-ul"></i>
                    <span>Anfragen</span>
                </button>
                <button class="mobile-tab-button" data-mobile-tab="details">
                    <i class="bi bi-info-circle"></i>
                    <span>Details</span>
                </button>
                <button class="mobile-tab-button" data-mobile-tab="calendar">
                    <i class="bi bi-calendar3"></i>
                    <span>Kalender</span>
                </button>
                <button class="mobile-tab-button" data-mobile-tab="chat">
                    <i class="bi bi-chat-dots"></i>
                    <span>Chat</span>
                </button>
                <button class="mobile-tab-button" data-mobile-tab="notes">
                    <i class="bi bi-sticky"></i>
                    <span>Notizen</span>
                </button>
            </div>

            <!-- Mobile Tab Content: Anfragen -->
            <div class="mobile-tab-content active" id="mobile-tab-requests">
                <div class="filter-section">
                    <div class="filter-row">
                        <select class="filter-select" id="filterStatusMobile">
                            <option value="all">Alle Status</option>
                            <option value="new">Neu</option>
                            <option value="seen">Gesehen</option>
                            <option value="confirmed">Best√§tigt</option>
                            <option value="rejected">Abgelehnt</option>
                        </select>
                        <select class="filter-select" id="filterTimeMobile">
                            <option value="all">Alle Zeitr√§ume</option>
                            <option value="next-month">N√§chster Monat</option>
                            <option value="this-season">Diese Saison</option>
                        </select>
                    </div>
                    <input type="text" class="search-input" placeholder="Suche nach Verein oder Zeitraum..." id="searchInputMobile">
                </div>
                <div class="requests-list" id="requestsListMobile">
                    <!-- Anfragen werden hier dynamisch eingef√ºgt -->
                </div>
            </div>

            <!-- Mobile Tab Content: Details -->
            <div class="mobile-tab-content" id="mobile-tab-details">
                <div id="detailContentMobile">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="bi bi-inbox"></i>
                        </div>
                        <div class="empty-state-title">Keine Anfrage ausgew√§hlt</div>
                        <div class="empty-state-text">
                            W√§hle eine Anfrage aus, um Details anzuzeigen.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Tab Content: Kalender -->
            <div class="mobile-tab-content" id="mobile-tab-calendar">
                <div class="calendar-widget">
                    <div class="calendar-header">
                        <h3 class="calendar-title">August 2025</h3>
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" onclick="previousMonth()" aria-label="Vorheriger Monat">
                                <i class="bi bi-chevron-left"></i>
                            </button>
                            <button class="calendar-nav-btn" onclick="nextMonth()" aria-label="N√§chster Monat">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="calendar-legend">
                        <div class="legend-item">
                            <div class="legend-dot current"></div>
                            <span>Aktuelle Anfrage</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot confirmed"></div>
                            <span>Best√§tigt</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot pending"></div>
                            <span>Offen</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot blocked"></div>
                            <span>Sperrzeit</span>
                        </div>
                    </div>
                    <div id="calendarContainerMobile"></div>
                </div>
            </div>

            <!-- Mobile Tab Content: Chat -->
            <div class="mobile-tab-content" id="mobile-tab-chat">
                <div id="chatContentMobile">
                    <div class="chat-empty-state">
                        <div class="chat-empty-icon">
                            <i class="bi bi-chat-dots"></i>
                        </div>
                        <div>W√§hle eine Anfrage aus, um den Chat zu sehen</div>
                    </div>
                </div>
            </div>

            <!-- Mobile Tab Content: Notizen -->
            <div class="mobile-tab-content" id="mobile-tab-notes">
                <div id="notesContentMobile">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="bi bi-sticky"></i>
                        </div>
                        <div class="empty-state-title">Keine Notizen</div>
                        <div class="empty-state-text">
                            W√§hle eine Anfrage aus, um Notizen anzuzeigen.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Layout -->
        <div class="manager-layout">
            
            <!-- Linke Spalte: Anfrageliste -->
            <div class="requests-panel">
                <div class="panel-header">
                    <h2 class="panel-title">Eingegangene Anfragen</h2>
                    <p class="panel-subtitle">Flugplatz Ohlstadt</p>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="filter-row">
                        <select class="filter-select" id="filterStatus">
                            <option value="all">Alle Status</option>
                            <option value="new">Neu</option>
                            <option value="seen">Gesehen</option>
                            <option value="confirmed">Best√§tigt</option>
                            <option value="rejected">Abgelehnt</option>
                            <option value="active">Laufend</option>
                        </select>
                        <select class="filter-select" id="filterTime">
                            <option value="all">Alle Zeitr√§ume</option>
                            <option value="next-month">N√§chster Monat</option>
                            <option value="this-season">Diese Saison</option>
                        </select>
                    </div>
                    <input type="text" class="search-input" placeholder="Suche nach Verein oder Zeitraum..." id="searchInput">
                    <div class="filter-stats">
                        <span id="filterStatsText">12 Anfragen gefunden</span>
                        <button class="button-secondary" style="padding: 0.25rem 0.75rem; font-size: 0.75rem;" onclick="openCalendarView()">
                            <i class="bi bi-calendar3"></i>
                            Kalenderansicht
                        </button>
                    </div>
                </div>

                <div class="requests-list" id="requestsList">
                    <!-- Anfragen werden hier dynamisch eingef√ºgt -->
                </div>
            </div>

            <!-- Mittlere Spalte: Detail + Kalender -->
            <div class="detail-panel">
                <div id="detailContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="bi bi-inbox"></i>
                        </div>
                        <div class="empty-state-title">Keine Anfrage ausgew√§hlt</div>
                        <div class="empty-state-text">
                            W√§hle eine Anfrage aus der Liste links aus, um Details anzuzeigen.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rechte Spalte: Communication (Chat & Notizen) -->
            <div class="communication-panel" id="communicationPanel">
                <div class="communication-tabs">
                    <button class="comm-tab active" data-comm-tab="chat">
                        <i class="bi bi-chat-dots"></i>
                        Chat
                    </button>
                    <button class="comm-tab" data-comm-tab="notes">
                        <i class="bi bi-sticky"></i>
                        Interne Notizen
                    </button>
                </div>

                <!-- Chat Tab -->
                <div class="comm-tab-content active" id="comm-chat">
                    <div class="chat-empty-state">
                        <div class="chat-empty-icon">
                            <i class="bi bi-chat-dots"></i>
                        </div>
                        <div>W√§hle eine Anfrage aus, um den Chat zu sehen</div>
                    </div>
                </div>

                <!-- Notes Tab -->
                <div class="comm-tab-content" id="comm-notes">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="bi bi-sticky"></i>
                        </div>
                        <div class="empty-state-title">Keine Notizen</div>
                        <div class="empty-state-text">
                            W√§hle eine Anfrage aus, um Notizen anzuzeigen.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Projekt Main JS -->
    <script src="assets/main.js"></script>

    <script>
        // Demo-Datenstruktur
        const requests = [
            {
                id: 1,
                organizer: "SFG Werdenfels e.V.",
                campName: "Jugendlager 2025",
                contactPerson: "Markus Klein",
                email: "m.klein@sfg-werdenfels.de",
                phone: "+49 172 123 4567",
                dateRange: "12.08.2025 ‚Äì 19.08.2025",
                dateStart: "2025-08-12",
                dateEnd: "2025-08-19",
                people: 18,
                aircraft: 6,
                status: "new",
                statusText: "‚è≥ Neu",
                statusTooltip: "Neue Anfrage ‚Äì noch nicht ge√∂ffnet",
                comment: "Wir sind eine gemischte Gruppe aus Jugendlichen und erfahrenen Piloten. W√ºrden uns √ºber eine Best√§tigung freuen!",
                chat: [
                    { sender: "received", text: "Hallo! Wir w√ºrden gerne unser Jugendlager bei euch machen. H√§tten Sie im August noch Kapazit√§ten?", time: "10.11. 09:15" }
                ],
                notes: []
            },
            {
                id: 2,
                organizer: "Aero Club M√ºnchen",
                campName: "Sommerfluglager",
                contactPerson: "Sandra Weber",
                email: "weber@aeroclub-muc.de",
                phone: "+49 89 987 6543",
                dateRange: "05.08.2025 ‚Äì 12.08.2025",
                dateStart: "2025-08-05",
                dateEnd: "2025-08-12",
                people: 22,
                aircraft: 8,
                status: "seen",
                statusText: "üëÅÔ∏è Gesehen",
                statusTooltip: "Anfrage wurde ge√∂ffnet",
                comment: "Gr√∂√üere Gruppe, w√ºrden eventuell Hallenpl√§tze f√ºr 3-4 Flugzeuge ben√∂tigen. K√∂nnen wir das vorher kl√§ren?",
                chat: [
                    { sender: "received", text: "Guten Tag! Wir planen ein Sommerlager Anfang August. Ist da bei euch noch frei?", time: "08.11. 14:30" },
                    { sender: "sent", text: "Hallo Frau Weber! Der Zeitraum ist grunds√§tzlich m√∂glich. Wie viele Hallenpl√§tze ben√∂tigen Sie genau?", time: "09.11. 10:20" },
                    { sender: "received", text: "Wir br√§uchten idealerweise 3-4 Hallenpl√§tze f√ºr die wertvolleren Flugzeuge.", time: "09.11. 11:45" }
                ],
                notes: [
                    { author: "Thomas M.", date: "09.11.2025, 11:00", text: "Hallenpl√§tze f√ºr August pr√ºfen. Eventuell mit Nachbarverein abstimmen." }
                ]
            },
            {
                id: 3,
                organizer: "Segelfluggruppe Allg√§u",
                campName: "Alpenfluglager",
                contactPerson: "Peter Huber",
                email: "huber@sfg-allgaeu.de",
                phone: "+49 831 234 5678",
                dateRange: "15.08.2025 ‚Äì 22.08.2025",
                dateStart: "2025-08-15",
                dateEnd: "2025-08-22",
                people: 15,
                aircraft: 5,
                status: "confirmed",
                statusText: "‚úÖ Best√§tigt",
                statusTooltip: "Lager best√§tigt ‚Äì Zeitraum blockiert",
                comment: "Langj√§hrige Gruppe, waren schon mehrmals bei euch. Freuen uns auf das Lager!",
                chat: [
                    { sender: "received", text: "Hallo! Wir w√ºrden gerne wieder zu euch kommen. Mitte August wie letztes Jahr?", time: "15.10. 10:00" },
                    { sender: "sent", text: "Hallo Herr Huber! Sch√∂n, dass Sie wiederkommen. Der Zeitraum ist frei, ich best√§tige Ihnen das gerne.", time: "15.10. 11:30" },
                    { sender: "received", text: "Perfekt! Dann bis August. Wir melden uns noch wegen der Teilnehmerliste.", time: "15.10. 12:15" },
                    { sender: "sent", text: "Sehr gerne! Die Liste br√§uchten wir bis ca. 2 Wochen vorher.", time: "15.10. 13:00" }
                ],
                notes: [
                    { author: "Thomas M.", date: "15.10.2025, 12:00", text: "Stammgast ‚Äì unkompliziert. Zeitraum im Kalender blockiert." }
                ]
            },
            {
                id: 4,
                organizer: "LSV Stuttgart",
                campName: "Vereins-Fluglager",
                contactPerson: "Julia Schneider",
                email: "schneider@lsv-stuttgart.de",
                phone: "+49 711 456 7890",
                dateRange: "10.08.2025 ‚Äì 17.08.2025",
                dateStart: "2025-08-10",
                dateEnd: "2025-08-17",
                people: 20,
                aircraft: 7,
                status: "rejected",
                statusText: "‚ùå Abgelehnt",
                statusTooltip: "Anfrage abgelehnt ‚Äì Zeitraum nicht verf√ºgbar",
                comment: "Wir sind flexibel mit dem Zeitraum, falls unsere Wunschtermine schon belegt sind.",
                chat: [
                    { sender: "received", text: "Hallo! Wir w√ºrden gerne Mitte August zu euch kommen.", time: "05.11. 15:20" },
                    { sender: "sent", text: "Hallo Frau Schneider! Leider ist dieser Zeitraum bereits durch ein anderes Lager blockiert. Wir h√§tten aber Ende August oder Anfang September noch frei. W√§re das eine Option?", time: "06.11. 09:00" },
                    { sender: "received", text: "Schade, aber danke f√ºr das Angebot. Unsere Termine sind leider festgelegt. Vielleicht n√§chstes Jahr!", time: "06.11. 10:30" }
                ],
                notes: [
                    { author: "Thomas M.", date: "06.11.2025, 09:15", text: "Zeitraum belegt durch SFG Allg√§u. Alternativen angeboten, aber nicht passend f√ºr LSV." }
                ]
            },
            {
                id: 5,
                organizer: "Luftsportverein Ulm",
                campName: "Herbstlager 2025",
                contactPerson: "Michael Bauer",
                email: "bauer@lsv-ulm.de",
                phone: "+49 731 789 0123",
                dateRange: "20.09.2025 ‚Äì 27.09.2025",
                dateStart: "2025-09-20",
                dateEnd: "2025-09-27",
                people: 12,
                aircraft: 4,
                status: "new",
                statusText: "‚è≥ Neu",
                statusTooltip: "Neue Anfrage ‚Äì noch nicht ge√∂ffnet",
                comment: "Kleinere Gruppe, haupts√§chlich Thermikfliegen geplant. Schlepphilfe w√§re toll!",
                chat: [
                    { sender: "received", text: "Guten Tag! H√§tten Sie Ende September noch Platz f√ºr eine kleine Gruppe?", time: "11.11. 08:30" }
                ],
                notes: []
            },
            {
                id: 6,
                organizer: "SFG Schwaben",
                campName: "Streckenfluglager",
                contactPerson: "Thomas Fischer",
                email: "fischer@sfg-schwaben.de",
                phone: "+49 821 345 6789",
                dateRange: "01.09.2025 ‚Äì 08.09.2025",
                dateStart: "2025-09-01",
                dateEnd: "2025-09-08",
                people: 16,
                aircraft: 6,
                status: "seen",
                statusText: "üëÅÔ∏è Gesehen",
                statusTooltip: "Anfrage wurde ge√∂ffnet",
                comment: "Wir konzentrieren uns auf Streckenfl√ºge. Gute Thermik im September erhofft!",
                chat: [
                    { sender: "received", text: "Hallo! September sollte thermisch gut sein bei euch. H√§tten wir da Chancen?", time: "10.11. 16:45" },
                    { sender: "sent", text: "Hallo Herr Fischer! September ist tats√§chlich oft noch gut. Ich schaue mir Ihre Anfrage an und melde mich zeitnah.", time: "11.11. 09:00" }
                ],
                notes: []
            }
        ];

        // Aktuelle Auswahl
        let currentRequest = null;
        let currentCommTab = 'chat';

        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            loadRequestsList();
            generateCalendar();
            
            // Filter Events Desktop
            document.getElementById('filterStatus')?.addEventListener('change', filterRequests);
            document.getElementById('filterTime')?.addEventListener('change', filterRequests);
            document.getElementById('searchInput')?.addEventListener('input', filterRequests);

            // Filter Events Mobile
            document.getElementById('filterStatusMobile')?.addEventListener('change', filterRequests);
            document.getElementById('filterTimeMobile')?.addEventListener('change', filterRequests);
            document.getElementById('searchInputMobile')?.addEventListener('input', filterRequests);

            // Communication Tabs
            const commTabs = document.querySelectorAll('.comm-tab');
            commTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-comm-tab');
                    
                    commTabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.comm-tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById('comm-' + targetTab).classList.add('active');
                    
                    currentCommTab = targetTab;
                });
            });

            // Mobile Tabs
            const mobileTabButtons = document.querySelectorAll('.mobile-tab-button');
            mobileTabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-mobile-tab');
                    
                    mobileTabButtons.forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.mobile-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    document.getElementById('mobile-tab-' + targetTab).classList.add('active');
                });
            });
        });

        // Anfrageliste laden
        function loadRequestsList() {
            const requestsList = document.getElementById('requestsList');
            const requestsListMobile = document.getElementById('requestsListMobile');
            
            const html = requests.map(req => {
                const isNew = req.status === 'new';
                
                return `
                    <div class="request-list-card ${req.status} ${currentRequest?.id === req.id ? 'active' : ''}" 
                         onclick="selectRequest(${req.id})"
                         role="button"
                         tabindex="0"
                         aria-label="Anfrage ${req.organizer}">
                        ${isNew ? '<div class="new-badge" aria-label="Neue Anfrage">!</div>' : ''}
                        <div class="request-card-header-small">
                            <div style="flex: 1;">
                                <div class="request-card-organizer">${req.organizer}</div>
                                <div class="request-card-campname">${req.campName}</div>
                            </div>
                        </div>
                        <div class="request-card-date">
                            <i class="bi bi-calendar-event"></i>
                            ${req.dateRange}
                        </div>
                        <div class="request-card-meta">
                            <div class="request-card-meta-item">
                                <i class="bi bi-people"></i>
                                ${req.people}
                            </div>
                            <div class="request-card-meta-item">
                                <i class="bi bi-airplane"></i>
                                ${req.aircraft}
                            </div>
                        </div>
                        <div>
                            <div class="status-badge-wrapper">
                                <span class="badge-custom badge-${req.status}" aria-label="${req.statusTooltip}">
                                    ${req.statusText}
                                </span>
                                <div class="status-badge-tooltip">${req.statusTooltip}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (requestsList) requestsList.innerHTML = html;
            if (requestsListMobile) requestsListMobile.innerHTML = html;
            
            updateFilterStats();
        }

        // Anfrage ausw√§hlen
        function selectRequest(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            // Status auf "gesehen" setzen wenn "neu"
            if (request.status === 'new') {
                request.status = 'seen';
                request.statusText = 'üëÅÔ∏è Gesehen';
                request.statusTooltip = 'Anfrage wurde ge√∂ffnet';
            }
            
            currentRequest = request;
            loadRequestsList();
            
            const isConfirmed = request.status === 'confirmed';
            const isRejected = request.status === 'rejected';
            const isNew = request.status === 'new';
            const isSeen = request.status === 'seen';
            const canApprove = isSeen || isNew;
            
            // Detail-HTML generieren
            const detailHTML = `
                <!-- Header mit Status und Actions -->
                <div class="detail-header">
                    <div class="detail-header-top">
                        <div class="detail-header-info">
                            <div class="detail-organizer-name">${request.organizer}</div>
                            <div class="detail-camp-name">${request.campName}</div>
                            <div class="detail-contact">
                                <div class="detail-contact-item">
                                    <i class="bi bi-person"></i>
                                    <span>${request.contactPerson}</span>
                                </div>
                                <div class="detail-contact-item">
                                    <i class="bi bi-envelope"></i>
                                    <span>${request.email}</span>
                                </div>
                                <div class="detail-contact-item">
                                    <i class="bi bi-telephone"></i>
                                    <span>${request.phone}</span>
                                </div>
                            </div>
                        </div>
                        ${canApprove ? `
                            <div class="detail-header-actions">
                                <button class="btn-approve" onclick="approveRequest(${request.id})">
                                    <i class="bi bi-check-lg"></i>
                                    Anfrage best√§tigen
                                </button>
                                <button class="btn-reject" onclick="rejectRequest(${request.id})">
                                    <i class="bi bi-x-lg"></i>
                                    Anfrage ablehnen
                                </button>
                                <button class="btn-message" onclick="openChat()">
                                    <i class="bi bi-chat-dots"></i>
                                    Nachricht senden
                                </button>
                            </div>
                        ` : isConfirmed ? `
                            <div class="detail-header-actions">
                                <span class="badge-custom badge-confirmed" style="padding: 0.75rem 1rem;">
                                    <i class="bi bi-check-circle"></i>
                                    ${request.statusText}
                                </span>
                                <button class="btn-message" onclick="openChat()">
                                    <i class="bi bi-chat-dots"></i>
                                    Nachricht senden
                                </button>
                            </div>
                        ` : isRejected ? `
                            <div class="detail-header-actions">
                                <span class="badge-custom badge-rejected" style="padding: 0.75rem 1rem;">
                                    <i class="bi bi-x-circle"></i>
                                    ${request.statusText}
                                </span>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <!-- Scrollbarer Content -->
                <div class="detail-scrollable">
                    <div class="detail-body">
                        ${isConfirmed ? `
                            <div class="info-box success">
                                <div class="info-box-icon">
                                    <i class="bi bi-check-circle"></i>
                                </div>
                                <div class="info-box-content">
                                    <div class="info-box-title">Anfrage best√§tigt</div>
                                    <div class="info-box-text">Dieses Lager wurde best√§tigt und ist im Kalender eingetragen.</div>
                                </div>
                            </div>
                        ` : isRejected ? `
                            <div class="info-box error">
                                <div class="info-box-icon">
                                    <i class="bi bi-x-circle"></i>
                                </div>
                                <div class="info-box-content">
                                    <div class="info-box-title">Anfrage abgelehnt</div>
                                    <div class="info-box-text">Diese Anfrage wurde abgelehnt. Der Organisator wurde informiert.</div>
                                </div>
                            </div>
                        ` : ''}

                        <div class="detail-section">
                            <div class="detail-section-title">Anfragedetails</div>
                            
                            <div class="form-row-inline">
                                <div class="form-group-inline">
                                    <label class="form-label-inline">Zeitraum</label>
                                    <input 
                                        type="text" 
                                        class="form-input-inline" 
                                        value="${request.dateRange}" 
                                        ${isConfirmed || isRejected ? 'disabled' : ''}>
                                </div>
                                <div class="form-group-inline">
                                    <label class="form-label-inline">Personen</label>
                                    <input 
                                        type="number" 
                                        class="form-input-inline" 
                                        value="${request.people}" 
                                        disabled>
                                </div>
                                <div class="form-group-inline">
                                    <label class="form-label-inline">Flugzeuge</label>
                                    <input 
                                        type="number" 
                                        class="form-input-inline" 
                                        value="${request.aircraft}" 
                                        disabled>
                                </div>
                            </div>

                            <div class="form-group-inline">
                                <label class="form-label-inline">Kommentar des Organisators</label>
                                <textarea class="form-textarea-inline" disabled>${request.comment}</textarea>
                            </div>
                        </div>

                        <!-- Kalender -->
                        <div class="calendar-widget">
                            <div class="calendar-header">
                                <h3 class="calendar-title">Platzbelegung August 2025</h3>
                                <div class="calendar-nav">
                                    <button class="calendar-nav-btn" onclick="previousMonth()">
                                        <i class="bi bi-chevron-left"></i>
                                    </button>
                                    <button class="calendar-nav-btn" onclick="nextMonth()">
                                        <i class="bi bi-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="calendar-legend">
                                <div class="legend-item">
                                    <div class="legend-dot current"></div>
                                    <span>Aktuelle Anfrage</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-dot confirmed"></div>
                                    <span>Best√§tigt</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-dot pending"></div>
                                    <span>Offen</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-dot blocked"></div>
                                    <span>Sperrzeit</span>
                                </div>
                            </div>
                            
                            <div id="calendarContainer"></div>
                        </div>
                    </div>
                </div>
            `;
            
            const detailContent = document.getElementById('detailContent');
            const detailContentMobile = document.getElementById('detailContentMobile');
            
            if (detailContent) detailContent.innerHTML = detailHTML;
            if (detailContentMobile) detailContentMobile.innerHTML = detailHTML;
            
            // Chat und Notizen laden
            loadChat(request);
            loadNotes(request);
            
            // Kalender generieren
            generateCalendar();
            
            // Auf Mobile zum Details-Tab wechseln
            if (window.innerWidth <= 768) {
                document.querySelectorAll('.mobile-tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.mobile-tab-content').forEach(content => content.classList.remove('active'));
                
                const detailsButton = document.querySelector('[data-mobile-tab="details"]');
                const detailsContent = document.getElementById('mobile-tab-details');
                
                if (detailsButton) detailsButton.classList.add('active');
                if (detailsContent) detailsContent.classList.add('active');
            }
        }

        // Chat laden
        function loadChat(request) {
            const chatHTML = `
                <div class="chat-messages">
                    ${request.chat.map(msg => `
                        <div class="chat-message ${msg.sender}">
                            <div class="chat-message-avatar">${msg.sender === 'sent' ? 'F' : request.organizer.charAt(0)}</div>
                            <div class="chat-message-content">
                                <div class="chat-message-bubble">${msg.text}</div>
                                <div class="chat-message-time">${msg.time}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="chat-footer">
                    <textarea 
                        class="chat-textarea" 
                        placeholder="Nachricht an ${request.contactPerson} schreiben..."
                        onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendChatMessage(${request.id}); }"></textarea>
                    <button class="chat-send-button" onclick="sendChatMessage(${request.id})">
                        <i class="bi bi-send"></i>
                    </button>
                </div>
            `;
            
            const chatTab = document.getElementById('comm-chat');
            const chatContentMobile = document.getElementById('chatContentMobile');
            
            if (chatTab) chatTab.innerHTML = chatHTML;
            if (chatContentMobile) chatContentMobile.innerHTML = chatHTML;
            
            // Scroll zum Ende
            const chatMessages = document.querySelector('.chat-messages');
            if (chatMessages) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // Notizen laden
        function loadNotes(request) {
            const notesHTML = `
                <div class="notes-container">
                    ${request.notes.length > 0 ? request.notes.map(note => `
                        <div class="note-item">
                            <div class="note-header">
                                <span class="note-author">${note.author}</span>
                                <span class="note-date">${note.date}</span>
                            </div>
                            <div class="note-text">${note.text}</div>
                        </div>
                    `).join('') : `
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="bi bi-sticky"></i>
                            </div>
                            <div class="empty-state-title">Keine Notizen</div>
                            <div class="empty-state-text">
                                F√ºge interne Notizen zu dieser Anfrage hinzu.
                            </div>
                        </div>
                    `}
                </div>
                
                <div class="notes-footer">
                    <textarea 
                        class="note-textarea" 
                        placeholder="Interne Notiz hinzuf√ºgen (nur f√ºr Platzteam sichtbar)..."
                        id="noteTextarea-${request.id}"></textarea>
                    <button class="button button-primary" onclick="addNote(${request.id})" style="width: 100%;">
                        <i class="bi bi-plus-lg"></i>
                        Notiz hinzuf√ºgen
                    </button>
                </div>
            `;
            
            const notesTab = document.getElementById('comm-notes');
            const notesContentMobile = document.getElementById('notesContentMobile');
            
            if (notesTab) notesTab.innerHTML = notesHTML;
            if (notesContentMobile) notesContentMobile.innerHTML = notesHTML;
        }

        // Kalender generieren
        function generateCalendar() {
            const containers = ['calendarContainer', 'calendarContainerMobile'];
            
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                const daysOfWeek = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
                const daysInMonth = 31;
                
                let html = '<div class="calendar-grid">';
                
                // Wochentage
                daysOfWeek.forEach(day => {
                    html += `<div class="calendar-day-header">${day}</div>`;
                });
                
                // Leere Tage am Anfang (August 2025 startet am Freitag)
                for (let i = 0; i < 4; i++) {
                    html += '<div class="calendar-day disabled"></div>';
                }
                
                // Tage des Monats
                for (let day = 1; day <= daysInMonth; day++) {
                    let dayClass = 'calendar-day';
                    
                    // Beispiel-Belegungen
                    if (currentRequest) {
                        const startDay = parseInt(currentRequest.dateStart.split('-')[2]);
                        const endDay = parseInt(currentRequest.dateEnd.split('-')[2]);
                        
                        if (day >= startDay && day <= endDay) {
                            dayClass += ' current';
                        }
                    }
                    
                    // Andere best√§tigte Lager
                    if (day >= 15 && day <= 22) {
                        dayClass += ' confirmed';
                    }
                    
                    // Offene Anfragen
                    if (day >= 5 && day <= 12 && !dayClass.includes('current')) {
                        dayClass += ' pending';
                    }
                    
                    // Heute
                    if (day === 11) {
                        dayClass += ' today';
                    }
                    
                    html += `<div class="${dayClass}" onclick="handleDayClick(${day})">${day}</div>`;
                }
                
                html += '</div>';
                container.innerHTML = html;
            });
        }

        // Anfrage best√§tigen
        function approveRequest(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            const modalHTML = `
                <div class="modal-overlay" onclick="closeModal(event)">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Anfrage best√§tigen</h3>
                        </div>
                        <div class="modal-body">
                            <p class="modal-description">
                                M√∂chtest du die Anfrage von <strong>${request.organizer}</strong> f√ºr den Zeitraum 
                                <strong>${request.dateRange}</strong> best√§tigen?
                            </p>
                            <p class="modal-description">
                                Der Zeitraum wird im Kalender blockiert und der Organisator wird per E-Mail und Chat benachrichtigt.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button class="button button-secondary" onclick="closeModal()">
                                Abbrechen
                            </button>
                            <button class="button button-primary" onclick="confirmApproval(${requestId})">
                                <i class="bi bi-check-lg"></i>
                                Jetzt best√§tigen
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Best√§tigung durchf√ºhren
        function confirmApproval(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            request.status = 'confirmed';
            request.statusText = '‚úÖ Best√§tigt';
            request.statusTooltip = 'Lager best√§tigt ‚Äì Zeitraum blockiert';
            
            // Chatnachricht hinzuf√ºgen
            const now = new Date();
            const timeStr = `${now.getDate().toString().padStart(2, '0')}.${(now.getMonth() + 1).toString().padStart(2, '0')}. ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            request.chat.push({
                sender: 'sent',
                text: 'Ihre Anfrage wurde best√§tigt! Der Zeitraum ist f√ºr Sie reserviert. Wir freuen uns auf Ihr Lager!',
                time: timeStr
            });
            
            closeModal();
            loadRequestsList();
            selectRequest(requestId);
            showSnackbar('Anfrage best√§tigt und im Kalender eingetragen', 'success');
        }

        // Anfrage ablehnen
        function rejectRequest(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            const modalHTML = `
                <div class="modal-overlay" onclick="closeModal(event)">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Anfrage ablehnen</h3>
                        </div>
                        <div class="modal-body">
                            <p class="modal-description">
                                M√∂chtest du die Anfrage von <strong>${request.organizer}</strong> ablehnen?
                            </p>
                            <div class="form-group-inline">
                                <label class="form-label-inline">Grund f√ºr die Ablehnung (optional)</label>
                                <textarea 
                                    class="form-textarea-inline" 
                                    id="rejectionReason"
                                    placeholder="z.B. Zeitraum bereits belegt, zu gro√üe Gruppe, ..."></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="button button-secondary" onclick="closeModal()">
                                Abbrechen
                            </button>
                            <button class="button button-danger" onclick="confirmRejection(${requestId})">
                                <i class="bi bi-x-lg"></i>
                                Ablehnen
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Ablehnung durchf√ºhren
        function confirmRejection(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            const reason = document.getElementById('rejectionReason')?.value || '';
            
            request.status = 'rejected';
            request.statusText = '‚ùå Abgelehnt';
            request.statusTooltip = 'Anfrage abgelehnt';
            
            // Chatnachricht hinzuf√ºgen
            const now = new Date();
            const timeStr = `${now.getDate().toString().padStart(2, '0')}.${(now.getMonth() + 1).toString().padStart(2, '0')}. ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            let message = 'Wir m√ºssen Ihre Anfrage leider ablehnen.';
            if (reason) {
                message += ' Grund: ' + reason;
            }
            
            request.chat.push({
                sender: 'sent',
                text: message,
                time: timeStr
            });
            
            closeModal();
            loadRequestsList();
            selectRequest(requestId);
            showSnackbar('Anfrage abgelehnt. Organisator wurde informiert.', 'success');
        }

        // Chat-Nachricht senden
        function sendChatMessage(requestId) {
            const textarea = document.querySelector('.chat-textarea');
            if (!textarea || !textarea.value.trim()) return;
            
            const message = textarea.value.trim();
            const request = requests.find(r => r.id === requestId);
            
            if (request) {
                const now = new Date();
                const timeStr = `${now.getDate().toString().padStart(2, '0')}.${(now.getMonth() + 1).toString().padStart(2, '0')}. ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                request.chat.push({
                    sender: 'sent',
                    text: message,
                    time: timeStr
                });
                
                textarea.value = '';
                loadChat(request);
                showSnackbar('Nachricht gesendet', 'success');
            }
        }

        // Notiz hinzuf√ºgen
        function addNote(requestId) {
            const textarea = document.getElementById(`noteTextarea-${requestId}`);
            if (!textarea || !textarea.value.trim()) return;
            
            const noteText = textarea.value.trim();
            const request = requests.find(r => r.id === requestId);
            
            if (request) {
                const now = new Date();
                const dateStr = `${now.getDate().toString().padStart(2, '0')}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getFullYear()}, ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                request.notes.push({
                    author: 'Thomas M.',
                    date: dateStr,
                    text: noteText
                });
                
                loadNotes(request);
                showSnackbar('Notiz hinzugef√ºgt', 'success');
            }
        }

        // Filter anwenden
        function filterRequests() {
            // Einfache Demo-Implementierung
            loadRequestsList();
        }

        function updateFilterStats() {
            const statsElement = document.getElementById('filterStatsText');
            if (statsElement) {
                statsElement.textContent = `${requests.length} Anfragen gefunden`;
            }
        }

        // Modal schlie√üen
        function closeModal(event) {
            if (event && !event.target.classList.contains('modal-overlay')) return;
            const modal = document.querySelector('.modal-overlay');
            if (modal) modal.remove();
        }

        // Chat √∂ffnen (f√ºr Mobile oder Desktop)
        function openChat() {
            if (window.innerWidth <= 768) {
                // Mobile: Wechsel zum Chat-Tab
                document.querySelectorAll('.mobile-tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.mobile-tab-content').forEach(content => content.classList.remove('active'));
                
                const chatButton = document.querySelector('[data-mobile-tab="chat"]');
                const chatContent = document.getElementById('mobile-tab-chat');
                
                if (chatButton) chatButton.classList.add('active');
                if (chatContent) chatContent.classList.add('active');
            } else {
                // Desktop: Wechsel zum Chat-Tab in Communication Panel
                document.querySelectorAll('.comm-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.comm-tab-content').forEach(content => content.classList.remove('active'));
                
                const chatTab = document.querySelector('[data-comm-tab="chat"]');
                const chatContent = document.getElementById('comm-chat');
                
                if (chatTab) chatTab.classList.add('active');
                if (chatContent) chatContent.classList.add('active');
                
                // Fokus auf Textarea
                setTimeout(() => {
                    const textarea = document.querySelector('.chat-textarea');
                    if (textarea) textarea.focus();
                }, 100);
            }
        }

        // Kalenderansicht √∂ffnen
        function openCalendarView() {
            showSnackbar('Kalenderansicht √∂ffnen (wird implementiert)', 'info');
        }

        // Kalender-Tag klicken
        function handleDayClick(day) {
            showSnackbar(`Tag ${day}. August ausgew√§hlt`, 'info');
        }

        // Kalender-Navigation
        function previousMonth() {
            showSnackbar('Navigation zum vorherigen Monat', 'info');
        }

        function nextMonth() {
            showSnackbar('Navigation zum n√§chsten Monat', 'info');
        }

        // Snackbar anzeigen
        function showSnackbar(message, type = 'info') {
            const snackbar = document.createElement('div');
            snackbar.className = `snackbar ${type}`;
            snackbar.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(snackbar);
            
            setTimeout(() => {
                snackbar.classList.add('hiding');
                setTimeout(() => snackbar.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
